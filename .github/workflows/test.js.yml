name: Run yarn test

on:
  push:
    branches-ignore: 
      - 'master'
      - 'production'

jobs:
  build:
    runs-on: ubuntu-latest
    
    services:
      postgres:
        image: postgis/postgis:12-3.0
        env:
          POSTGRES_USER=arena
          POSTGRES_PASSWORD=arena
          POSTGRES_DB=arena
        ports:
          - 5444:5432
        options: --health-cmd pg_isready --health-interval 10s --health-timeout 5s --health-retries 
          
    steps:
    - uses: actions/checkout@v2

    - name: Use Node.js 14.15.0
      uses: actions/setup-node@v1
      with:
        node-version: '14.15.0'
    - name: install browser dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y libwoff1 \
                      libopus0 \
                      libwebp6 \
                      libwebpdemux2 \
                      libenchant1c2a \
                      libgudev-1.0-0 \
                      libsecret-1-0 \
                      libhyphen0 \
                      libgdk-pixbuf2.0-0 \
                      libegl1 \
                      libnotify4 \
                      libxslt1.1 \
                      libevent-2.1-6 \
                      libgles2 \
                      libgl1 \
                      libegl1 \
                      libvpx5 \
                      libnss3 \
                      libxss1 \
                      libasound2 \
                      libdbus-glib-1-2 \
                      libxt6
    - run: yarn
    - run: yarn test
